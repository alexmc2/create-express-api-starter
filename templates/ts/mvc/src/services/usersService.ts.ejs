import usersRepository from '../repositories/usersRepository';
import AppError from '../errors/AppError';

interface CreateUserPayload {
  name?: unknown;
  email?: unknown;
}

<% if (educational) { %>// The service layer contains business logic and validation.
// It sits between controllers and repositories, keeping both thin.
<% } %>async function listUsers() {
  return usersRepository.getAll();
}

async function createUser(payload: CreateUserPayload) {
  const { name, email } = payload;

<% if (educational) { %>  // Validate before touching the database â€” throw an AppError
  // with a status code so the error handler can send the right response.
<% } %>  if (!name || typeof name !== 'string') {
    throw new AppError(400, '"name" is required.');
  }

  return usersRepository.create({
    name: name.trim(),
    email: typeof email === 'string' ? email.trim() : null
  });
}

export default {
  listUsers,
  createUser
};
