<% if (educational) { %>// File overview: Defines /api/users routes, including request validation and repository calls.
<% } %>
import { Router } from 'express';

import usersRepository from '../repositories/usersRepository';
import AppError from '../errors/AppError';

const router = Router();

<% if (educational) { %>// Async route handlers should pass failures to next(error) so the
// centralized error handler can return a consistent HTTP response.
<% } %>router.get('/', async (_req, res, next) => {
  try {
    const users = await usersRepository.getAll();
    res.status(200).json(users);
  } catch (error) {
    next(error);
  }
});

router.post('/', async (req, res, next) => {
  try {
<% if (educational) { %>    // Validate input at the API boundary before storing data.
    // Calling next(error) skips the rest of the handler and moves control
    // to the central error middleware, which formats the HTTP response.
<% } %>    const { name, email } = req.body ?? {};

    if (!name || typeof name !== 'string') {
      return next(new AppError(400, '"name" is required.'));
    }

    const user = await usersRepository.create({
      name: name.trim(),
      email: typeof email === 'string' ? email.trim() : null
    });

    return res.status(201).json(user);
  } catch (error) {
    return next(error);
  }
});

export default router;
